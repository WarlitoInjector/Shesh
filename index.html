<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barangay Census System</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);margin:0;padding:20px}
h1{text-align:center;color:#fff;margin-bottom:20px}
.container{max-width:1100px;margin:auto}
.section{background:#fff;padding:20px;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,0.15);margin-bottom:20px}
input,select,button{padding:10px;border-radius:8px;border:1px solid #ddd;font-family:'Poppins'}
input,select{width:100%;margin-bottom:10px}
button{background:#667eea;color:#fff;border:none;cursor:pointer;font-weight:600}
button:hover{opacity:0.9}
.flex{display:flex;gap:10px;flex-wrap:wrap}
.flex>*{flex:1}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;text-align:left}
th{background:#667eea;color:#fff}
tr:hover{background:#f2f2f2}
.avatar{width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600}
.badge{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:600;margin-right:4px;display:inline-block}
.badge-blue{background:#cce5ff}
.badge-green{background:#d4edda}
.badge-yellow{background:#fff3cd}
.status-group{display:flex;gap:10px;margin:10px 0;flex-wrap:wrap}
.radio-card{flex:1;cursor:pointer}
.radio-card input{display:none}
.radio-card span{display:block;padding:10px;border-radius:10px;border:2px solid #ddd;text-align:center;font-weight:600;transition:0.3s;background:#f9f9f9}
.radio-card input:checked + span{background:#667eea;color:#fff;border-color:#667eea}
</style>
</head>

<body>

<div class="container">
<h1>Barangay Census System</h1>

<div class="section">
<h3>Add Resident</h3>
<form id="censusForm">
<input type="hidden" id="editIndex">

<div class="flex">
<input type="text" id="fullname" placeholder="Full Name" required>
<select id="gender" required>
<option value="">Gender</option>
<option value="Male">Male</option>
<option value="Female">Female</option>
</select>
</div>

<div class="flex">
<input type="date" id="birthdate" required>
<select id="civilstatus" required>
<option value="">Civil Status</option>
<option>Single</option>
<option>Married</option>
<option>Widowed</option>
</select>
</div>

<div class="status-group">
<label class="radio-card">
<input type="radio" name="status" value="Voter" required>
<span>üó≥Ô∏è Voter</span>
</label>

<label class="radio-card">
<input type="radio" name="status" value="Student">
<span>üéì Student</span>
</label>

<label class="radio-card">
<input type="radio" name="status" value="Employed">
<span>üíº Employed</span>
</label>
</div>

<button type="submit">Save Resident</button>
</form>
</div>

<div class="section">
<h3>Resident List</h3>
<table>
<thead>
<tr>
<th>Avatar</th>
<th>Name</th>
<th>Age</th>
<th>Civil Status</th>
<th>Tags</th>
<th>Action</th>
</tr>
</thead>
<tbody id="dataTable"></tbody>
</table>
</div>
</div>

<!-- FIREBASE SCRIPT -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  updateDoc,
  deleteDoc,
  doc,
  onSnapshot 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBBEQe3_cC9CWej-cDCZ9HMUzSj0xwtMi0",
  authDomain: "shesh-c86b5.firebaseapp.com",
  projectId: "shesh-c86b5",
  storageBucket: "shesh-c86b5.firebasestorage.app",
  messagingSenderId: "403916968425",
  appId: "1:403916968425:web:9bff1dd6eb0c8def257b78",
  measurementId: "G-7M1BC9L6J4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const censusCollection = collection(db, "residents");

let people = [];

function calculateAge(b){
  let t=new Date(),birth=new Date(b);
  let age=t.getFullYear()-birth.getFullYear();
  let m=t.getMonth()-birth.getMonth();
  if(m<0||(m===0&&t.getDate()<birth.getDate()))age--;
  return age;
}

function randomColor(){
  return "#"+Math.floor(Math.random()*16777215).toString(16);
}

onSnapshot(censusCollection, (snapshot)=>{
  people = [];
  snapshot.forEach(docSnap=>{
    people.push({ id: docSnap.id, ...docSnap.data() });
  });
  renderTable();
});

function renderTable(){
  let table=document.getElementById("dataTable");
  table.innerHTML="";

  people.forEach((p)=>{
    let age=calculateAge(p.birthdate);
    let tags="";

    if(p.status==="Voter")tags+="<span class='badge badge-blue'>Voter</span>";
    if(p.status==="Student")tags+="<span class='badge badge-yellow'>Student</span>";
    if(p.status==="Employed")tags+="<span class='badge badge-green'>Employed</span>";
    if(age>=60)tags+="<span class='badge badge-blue'>Senior</span>";

    table.innerHTML+=`
    <tr>
      <td><div class='avatar' style='background:${randomColor()}'>${p.gender==="Male"?"M":"F"}</div></td>
      <td>${p.fullname}</td>
      <td>${age}</td>
      <td>${p.civilstatus}</td>
      <td>${tags}</td>
      <td>
        <button onclick="deleteData('${p.id}')">Delete</button>
      </td>
    </tr>`;
  });
}

document.getElementById("censusForm").addEventListener("submit", async function(e){
  e.preventDefault();

  let selectedStatus=document.querySelector('input[name="status"]:checked');

  let person={
    fullname:fullname.value,
    gender:gender.value,
    birthdate:birthdate.value,
    civilstatus:civilstatus.value,
    status:selectedStatus?selectedStatus.value:null
  };

  await addDoc(censusCollection, person);
  this.reset();
});

window.deleteData = async function(id){
  if(confirm("Delete this resident?")){
    await deleteDoc(doc(db,"residents",id));
  }
}

</script>

</body>
</html>
