<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Vote Tracker ni Warlito</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}

body{
background:radial-gradient(circle at top,#0f172a,#020617);
min-height:100vh;
color:white;
overflow-x:hidden;
}

.glass{
background:rgba(255,255,255,0.08);
backdrop-filter:blur(25px);
border-radius:22px;
padding:22px;
border:1px solid rgba(255,255,255,0.2);
box-shadow:0 20px 50px rgba(0,0,0,0.6);
margin-bottom:20px;
animation:fadeUp .5s ease;
}

@keyframes fadeUp{
from{opacity:0;transform:translateY(15px)}
to{opacity:1;transform:none}
}

input,select{
width:100%;
height:48px;
padding:0 14px;
margin-bottom:12px;
border-radius:14px;
border:1px solid rgba(255,255,255,0.25);
background:rgba(255,255,255,0.1);
color:white;
outline:none;
font-size:14px;
transition:.25s;
}

input:focus,select:focus{
border-color:#38bdf8;
box-shadow:0 0 0 2px rgba(56,189,248,.3);
}

select option{background:#020617;color:white}

button{
padding:10px 14px;
border:none;
border-radius:14px;
cursor:pointer;
font-weight:600;
transition:.25s;
}

button:active{transform:scale(.96)}

.primary{
background:linear-gradient(135deg,#3b82f6,#06b6d4);
color:white;
box-shadow:0 0 20px rgba(59,130,246,.35);
}

.primary:hover{box-shadow:0 0 30px rgba(59,130,246,.7)}

.edit-btn{background:#22c55e;color:white}
.delete-btn{background:#ef4444;color:white}

.logout{
position:fixed;
top:14px;
right:14px;
background:#ef4444;
color:white;
z-index:99;
}

#loginPage{
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
padding:20px;
}

.login-box{width:100%;max-width:360px}
#mainSystem{display:none;padding:20px}

.header{
display:flex;
align-items:center;
justify-content:space-between;
padding:18px 20px;
margin-bottom:20px;
}

.header-text h1{
font-size:clamp(20px,5vw,28px);
font-weight:700;
line-height:1.2;
white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis;
}

.header-text p{
font-size:13px;
opacity:.7;
margin-top:4px;
}

.dashboard{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
gap:12px;
}

.card{
padding:18px;
border-radius:18px;
background:rgba(255,255,255,0.06);
text-align:center;
border:1px solid rgba(255,255,255,0.15);
transition:.25s;
}

.card:hover{
transform:translateY(-4px);
background:rgba(255,255,255,0.1);
box-shadow:0 0 18px rgba(56,189,248,.25);
}

.card span{
display:block;
font-size:22px;
margin-top:6px;
font-weight:700;
}

.table-wrapper{
max-height:360px;
overflow:auto;
border-radius:14px;
}

table{
width:100%;
border-collapse:collapse;
min-width:520px;
}

th,td{
padding:10px;
font-size:14px;
}

thead th{
position:sticky;
top:0;
background:#020617;
z-index:2;
}

tr{transition:.2s}
tr:hover{background:rgba(255,255,255,0.08)}

.modal-overlay{
position:fixed;
inset:0;
background:rgba(0,0,0,0.65);
backdrop-filter:blur(8px);
display:flex;
align-items:center;
justify-content:center;
opacity:0;
visibility:hidden;
transition:.3s;
z-index:200;
}

.modal-overlay.active{
opacity:1;
visibility:visible;
}

.modal{
width:100%;
max-width:400px;
transform:scale(.85);
transition:.3s;
}

.modal-overlay.active .modal{transform:scale(1)}

.modal-buttons{
display:flex;
gap:10px;
margin-top:10px;
}

.cancel-btn{background:#64748b;color:white;flex:1}
.save-btn{background:#22c55e;color:white;flex:1}

@media(max-width:480px){
.logout{top:10px;right:10px}
.dashboard{grid-template-columns:repeat(2,1fr)}
.card span{font-size:18px}
.table-wrapper{max-height:300px}
}
</style>
</head>

<body>

<div id="loginPage">
<div class="glass login-box">
<h2 style="text-align:center;margin-bottom:20px;">üîê Admin Login</h2>
<input type="email" id="email" placeholder="Admin Email">
<input type="password" id="password" placeholder="Password">
<button class="primary" onclick="login()" style="width:100%;">Login</button>
<p id="error" style="color:#f87171;text-align:center;margin-top:10px;"></p>
</div>
</div>

<div id="mainSystem">
<button class="logout" onclick="logout()">Logout</button>

<div class="header glass">
  <div class="header-text">
    <h1>Vote Tracker</h1>
    <p>Admin Dashboard ¬∑ Warlito</p>
  </div>
</div>

<div class="glass">
<div class="dashboard">
<div class="card">Total<span id="totalCount">0</span></div>
<div class="card">Sa'kin<span id="sakinCount">0</span></div>
<div class="card">Hindi<span id="hindiCount">0</span></div>
<div class="card">Not Sure<span id="unsureCount">0</span></div>
<div class="card">Youth<span id="minorCount">0</span></div>
<div class="card">Adults<span id="adultCount">0</span></div>
</div>
</div>

<div class="glass">
<h3>Add Resident</h3>
<form id="addForm">
<input type="text" id="addName" placeholder="Full Name" required>

<select id="addGender" required>
<option value="">Gender</option>
<option>Male</option>
<option>Female</option>
</select>

<select id="addAgeGroup" required>
<option value="">Age Group</option>
<option value="Youth">Youth</option>
<option value="Adult">Adult</option>
</select>

<select id="addVote" required>
<option value="">Vote</option>
<option value="Sakin">Sa'kin</option>
<option value="Hindi Sakin">Hindi Sa'kin</option>
<option value="Hindi Sigurado">Not Sure</option>
</select>

<button class="primary" style="width:100%;">Add Resident</button>
</form>
</div>

<div class="glass">
<h3>Residents</h3>

<div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
<button class="primary" onclick="setAgeFilter('all')">All</button>
<button class="primary" onclick="setAgeFilter('minor')">Youth</button>
<button class="primary" onclick="setAgeFilter('adult')">Adults</button>
</div>

<input type="text" id="searchInput" placeholder="Search name...">

<div class="table-wrapper">
<table>
<thead>
<tr>
<th>Name</th>
<th>Gender</th>
<th>Age Group</th>
<th>Vote</th>
<th>Action</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>
</div>

<div class="modal-overlay" id="editModal">
<div class="glass modal">
<h3>Edit Resident</h3>

<input type="text" id="editName">
<select id="editGender">
<option>Male</option>
<option>Female</option>
</select>

<select id="editAgeGroup">
<option value="Youth">Youth</option>
<option value="Adult">Adult</option>
</select>

<select id="editVote">
<option value="Sakin">Sa'kin</option>
<option value="Hindi Sakin">Hindi Sa'kin</option>
<option value="Hindi Sigurado">Not Sure</option>
</select>

<div class="modal-buttons">
<button class="cancel-btn" onclick="closeModal()">Cancel</button>
<button class="save-btn" onclick="saveEdit()">Save</button>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBBEQe3_cC9CWej-cDCZ9HMUzSj0xwtMi0",
authDomain:"shesh-c86b5.firebaseapp.com",
projectId:"shesh-c86b5",
appId:"1:403916968425:web:9bff1dd6eb0c8def257b78"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const residents=collection(db,"residents");

let allData=[],selectedId=null,ageFilter="all";

/* AUTO CAPITALIZE NAME */
function autoCapitalizeName(name){
return name
.toLowerCase()
.split(" ")
.filter(w=>w.trim()!=="")
.map(w=>w.charAt(0).toUpperCase()+w.slice(1))
.join(" ");
}

window.login=async()=>{
try{
await signInWithEmailAndPassword(auth,email.value,password.value);
error.textContent="";
}catch{error.textContent="Invalid credentials"}
}

window.logout=async()=>{await signOut(auth)}

onAuthStateChanged(auth,u=>{
loginPage.style.display=u?"none":"flex";
mainSystem.style.display=u?"block":"none";
if(u) start();
});

function start(){
onSnapshot(residents,s=>{
allData=[];
s.forEach(d=>allData.push({id:d.id,...d.data()}));
render();
dashboard();
});

addForm.onsubmit=async e=>{
e.preventDefault();
await addDoc(residents,{
fullname:autoCapitalizeName(addName.value),
gender:addGender.value,
ageGroup:addAgeGroup.value,
vote:addVote.value
});
addForm.reset();
}
}

function render(){
let s=searchInput.value.toLowerCase();
tableBody.innerHTML="";
allData.filter(d=>{
if(ageFilter==="minor"&&d.ageGroup!=="Youth")return false;
if(ageFilter==="adult"&&d.ageGroup!=="Adult")return false;
return d.fullname.toLowerCase().includes(s);
}).forEach(d=>{
tableBody.innerHTML+=`
<tr>
<td>${d.fullname}</td>
<td>${d.gender}</td>
<td>${d.ageGroup}</td>
<td>${d.vote}</td>
<td>
<button class="edit-btn" onclick="openEdit('${d.id}')">Edit</button>
<button class="delete-btn" onclick="deleteData('${d.id}')">Delete</button>
</td>
</tr>`;
});
}

searchInput.oninput=render;
window.setAgeFilter=t=>{ageFilter=t;render()}
window.deleteData=id=>deleteDoc(doc(db,"residents",id))

window.openEdit=async id=>{
selectedId=id;
let d=(await getDoc(doc(db,"residents",id))).data();
editName.value=d.fullname;
editGender.value=d.gender;
editAgeGroup.value=d.ageGroup;
editVote.value=d.vote;
editModal.classList.add("active");
}

window.closeModal=()=>editModal.classList.remove("active")

window.saveEdit=async()=>{
await updateDoc(doc(db,"residents",selectedId),{
fullname:autoCapitalizeName(editName.value),
gender:editGender.value,
ageGroup:editAgeGroup.value,
vote:editVote.value
});
closeModal();
}

function dashboard(){
totalCount.textContent=allData.length;
sakinCount.textContent=allData.filter(d=>d.vote==="Sakin").length;
hindiCount.textContent=allData.filter(d=>d.vote==="Hindi Sakin").length;
unsureCount.textContent=allData.filter(d=>d.vote==="Hindi Sigurado").length;
minorCount.textContent=allData.filter(d=>d.ageGroup==="Youth").length;
adultCount.textContent=allData.filter(d=>d.ageGroup==="Adult").length;
}
</script>

</body>
</html>
